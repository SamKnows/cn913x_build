From 6049d6e4973eda3b9bfdf08ca93b3eb8edb7c7fb Mon Sep 17 00:00:00 2001
From: Alon Rotman <alon.rotman@solid-run.com>
Date: Thu, 5 Nov 2020 17:08:29 +0200
Subject: [PATCH 2/2] config: set i2c spd port to i2c1

Signed-off-by: Alon Rotman <alon.rotman@solid-run.com>
---
 .../armada/a8k/common/include/a8k_plat_def.h   |  1 +
 .../octeontx/otx2/t91/t9130/board/dram_port.c  | 18 +++++++++---------
 2 files changed, 10 insertions(+), 9 deletions(-)

diff --git a/plat/marvell/armada/a8k/common/include/a8k_plat_def.h b/plat/marvell/armada/a8k/common/include/a8k_plat_def.h
index de8031536..8f5cd89db 100644
--- a/plat/marvell/armada/a8k/common/include/a8k_plat_def.h
+++ b/plat/marvell/armada/a8k/common/include/a8k_plat_def.h
@@ -64,6 +64,7 @@
 #define MVEBU_AP_GPIO_DATA_IN		(MVEBU_AP_GPIO_REGS + 0x10)
 #define MVEBU_AP_I2C_BASE		(MVEBU_REGS_BASE + 0x511000)
 #define MVEBU_CP0_I2C_BASE		(MVEBU_CP_REGS_BASE(0) + 0x701000)
+#define MVEBU_CP0_I2C1_BASE		(MVEBU_CP_REGS_BASE(0) + 0x701100)
 #define MVEBU_AP_EXT_TSEN_BASE		(MVEBU_RFU_BASE + 0x8084)
 
 #define MVEBU_AP_MC_TRUSTZONE_REG_LOW(ap, win)	(MVEBU_REGS_BASE_AP(ap) + \
diff --git a/plat/marvell/octeontx/otx2/t91/t9130/board/dram_port.c b/plat/marvell/octeontx/otx2/t91/t9130/board/dram_port.c
index 358d86b23..9a7c5a38d 100644
--- a/plat/marvell/octeontx/otx2/t91/t9130/board/dram_port.c
+++ b/plat/marvell/octeontx/otx2/t91/t9130/board/dram_port.c
@@ -13,12 +13,12 @@
 #include <mv_ddr_if.h>
 #include <mvebu_def.h>
 #include <plat_marvell.h>
-
-//#define MVEBU_CP_MPP_CTRL37_OFFS		20
-//#define MVEBU_CP_MPP_CTRL38_OFFS		24
-//#define MVEBU_CP_MPP_CTRL37_I2C0_SCK_ENA	0x2
-//#define MVEBU_CP_MPP_CTRL38_I2C0_SDA_ENA	0x2
-
+/*
+*#define MVEBU_CP_MPP_CTRL37_OFFS		20
+*#define MVEBU_CP_MPP_CTRL38_OFFS		24
+*#define MVEBU_CP_MPP_CTRL37_I2C0_SCK_ENA	0x2
+*#define MVEBU_CP_MPP_CTRL38_I2C0_SDA_ENA	0x2
+*/
 
 #define MVEBU_CP_MPP_CTRL35_OFFS                12
 #define MVEBU_CP_MPP_CTRL36_OFFS                16
@@ -125,7 +125,7 @@ static void mpp_config(void)
 	uint32_t val;
 
 	reg = MVEBU_CP_MPP_REGS(0, 4);
-	/* configure CP0 MPP 37 and 38 to i2c */
+	/* configure CP0 MPP 35 and 36 to i2c */
 	val = mmio_read_32(reg);
 	val &= ~((MVEBU_MPP_CTRL_MASK << MVEBU_CP_MPP_CTRL35_OFFS) |
 		(MVEBU_MPP_CTRL_MASK << MVEBU_CP_MPP_CTRL36_OFFS));
@@ -152,10 +152,10 @@ void plat_marvell_dram_update_topology(void)
 		mpp_config();
 
 		/* initialize i2c */
-		i2c_init((void *)MVEBU_CP0_I2C_BASE);
+		i2c_init((void *)MVEBU_CP0_I2C1_BASE);
 
 		/* select SPD memory page 0 to access DRAM configuration */
-		i2c_write(I2C_SPD_P0_ADDR, 0x0, 1, tm->spd_data.all_bytes, 1);
+		i2c_write(I2C_SPD_P0_ADDR, 0x0, 1, tm->spd_data.all_bytes, 0);
 
 		/* read data from spd */
 		i2c_read(I2C_SPD_ADDR, 0x0, 1, tm->spd_data.all_bytes,
-- 
2.25.1

